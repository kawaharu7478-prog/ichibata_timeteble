<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>鉄道可視化</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    .station-line { stroke: black; stroke-width: 2; }
    .station-circle { fill: white; stroke: black; stroke-width: 2; }
    .station-label { font-size: 12px; text-anchor: middle; }
    .train-label { font-size: 12px; fill: white; pointer-events: none; }
  </style>
</head>
<body>
  <h2>路線図</h2>
  <svg id="map" width="800" height="600"></svg>
  <div>現在時刻: <span id="current-time"></span></div>

  <script>
    const stations = [
      { name: "川跡(本線)", x: 100, y: 100 },
      { name: "松江しんじ湖温泉", x: 700, y: 100 },
      { name: "川跡(支線)", x: 100, y: 200 },
      { name: "出雲大社前", x: 700, y: 200 }
    ];

    const svg = d3.select("#map");

    // 路線
    svg.append("line")
      .attr("x1", stations[0].x).attr("y1", stations[0].y)
      .attr("x2", stations[1].x).attr("y2", stations[1].y)
      .attr("class", "station-line");

    svg.append("line")
      .attr("x1", stations[2].x).attr("y1", stations[2].y)
      .attr("x2", stations[3].x).attr("y2", stations[3].y)
      .attr("class", "station-line");

    // 駅
    stations.forEach(s => {
      svg.append("circle")
        .attr("cx", s.x).attr("cy", s.y)
        .attr("r", 6).attr("class", "station-circle");

      svg.append("text")
        .attr("x", s.x).attr("y", s.y - 10)
        .attr("class", "station-label")
        .text(s.name);
    });

    // 列車アイコン（サンプル1本）
    function drawTrain(x, y, name, direction = "right") {
      const group = svg.append("g");

      const textLength = name.length * 12; // 長方形の横幅を文字数に合わせる
      const height = 20;

      group.append("rect")
        .attr("x", x).attr("y", y - height / 2)
        .attr("width", textLength).attr("height", height)
        .attr("fill", "blue");

      if (direction === "right") {
        group.append("polygon")
          .attr("points", `${x + textLength},${y - height / 2} ${x + textLength + 10},${y} ${x + textLength},${y + height / 2}`)
          .attr("fill", "blue");
      } else {
        group.append("polygon")
          .attr("points", `${x},${y - height / 2} ${x - 10},${y} ${x},${y + height / 2}`)
          .attr("fill", "blue");
      }

      group.append("text")
        .attr("x", x + textLength / 2)
        .attr("y", y + 4)
        .attr("text-anchor", "middle")
        .attr("class", "train-label")
        .text(name);
    }

    drawTrain(300, 100, "快速 出雲市行", "right");
    drawTrain(500, 200, "普通 出雲大社前", "left");

    // 時刻表示
    function updateTime() {
      const now = new Date();
      document.getElementById("current-time").textContent =
        now.toLocaleTimeString("ja-JP", { hour12: false });
    }
    setInterval(updateTime, 1000);
    updateTime();
  </script>
</body>
</html>
